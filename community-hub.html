<!DOCTYPE html>
<html lang="en" data-theme="worldpulse">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WorldPulse ‚Äî Community Votes (Placeholder)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/custom.css">
</head>
<body class="bg-base-100">
  <div id="shared-navbar"></div>

  <main class="page-content page-content-full">
    <div class="container-desktop mx-auto max-w-6xl p-4 py-12">
      <h1 class="text-4xl font-bold text-primary mb-2">üó≥Ô∏è Community Votes (Placeholder)</h1>
      <p class="text-muted mb-8">Vote on stories, roadmap ideas, and training requests from the community</p>

      <!-- Filter & Search Bar -->
      <div class="flex flex-col md:flex-row gap-4 mb-6">
        <div class="flex-1">
          <input type="text" id="search-input" placeholder="Search community items..." class="input-custom w-full" oninput="filterItems()">
        </div>
        <div>
          <select id="category-filter" class="input-custom w-full md:w-auto" onchange="filterItems()">
            <option value="all">All Categories</option>
            <option value="idea">üí° Ideas</option>
            <option value="story">üìñ Stories</option>
            <option value="training">üìö Training</option>
          </select>
        </div>
        <div>
          <select id="sort-filter" class="input-custom w-full md:w-auto" onchange="filterItems()">
            <option value="recent">Most Recent</option>
            <option value="popular">Most Popular</option>
          </select>
        </div>
      </div>

      <!-- Items Grid (placeholder cards) -->
      <div id="items-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="card-custom group">
          <div class="border-l-4 border-l-primary pl-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <span class="badge-custom primary">üí° Idea</span>
                <h3 class="text-lg font-bold text-primary mt-2">Peer Advisory Matching Algorithm</h3>
              </div>
              <div class="text-right">
                <div class="text-xl font-bold text-primary">42</div>
                <div class="text-xs text-muted">votes</div>
              </div>
            </div>
            <p class="text-sm text-text-primary mb-3">Auto-match projects with advisors based on expertise, location and experience.</p>
            <div class="flex justify-between items-center text-xs">
              <span class="text-muted">Alex Rivera</span>
              <span class="text-muted">2 days ago</span>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="btn btn-sm btn-primary-custom w-full">üëç Vote for Idea</button>
            </div>
          </div>
        </div>

        <div class="card-custom group">
          <div class="border-l-4 border-l-accent pl-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <span class="badge-custom accent">üìñ Story</span>
                <h3 class="text-lg font-bold text-primary mt-2">Peace is the dignity of every girl</h3>
              </div>
              <div class="text-right">
                <div class="text-xl font-bold text-accent">31</div>
                <div class="text-xs text-muted">votes</div>
              </div>
            </div>
            <p class="text-sm text-text-primary mb-3">Celebrating the inherent dignity and rights of girls worldwide in the pursuit of peace.</p>
            <div class="flex justify-between items-center text-xs">
              <span class="text-muted">Girls' Rights Advocate</span>
              <span class="text-muted">3 days ago</span>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="btn btn-sm btn-cta-custom w-full">‚≠ê Vote for Story</button>
            </div>
          </div>
        </div>

        <div class="card-custom group">
          <div class="border-l-4 border-l-cta pl-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <span class="badge-custom cta">üìö Training</span>
                <h3 class="text-lg font-bold text-primary mt-2">Social Media Strategy for NGOs</h3>
              </div>
              <div class="text-right">
                <div class="text-xl font-bold text-cta">24</div>
                <div class="text-xs text-muted">votes</div>
              </div>
            </div>
            <p class="text-sm text-text-primary mb-3">Help developing effective social media strategy to raise awareness about clean water initiative.</p>
            <div class="flex justify-between items-center text-xs">
              <span class="text-muted">Emma Thompson</span>
              <span class="text-muted">5 days ago</span>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="btn btn-sm btn-accent-custom w-full">üëç Endorse Training</button>
            </div>
          </div>
        </div>

        <div class="card-custom group">
          <div class="border-l-4 border-l-primary pl-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <span class="badge-custom primary">üí° Idea</span>
                <h3 class="text-lg font-bold text-primary mt-2">Offline Mode for Low Connectivity</h3>
              </div>
              <div class="text-right">
                <div class="text-xl font-bold text-primary">35</div>
                <div class="text-xs text-muted">votes</div>
              </div>
            </div>
            <p class="text-sm text-text-primary mb-3">Allow core features to work without internet and sync when connection returns.</p>
            <div class="flex justify-between items-center text-xs">
              <span class="text-muted">Tech Lead</span>
              <span class="text-muted">1 week ago</span>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="btn btn-sm btn-primary-custom w-full">üëç Vote for Idea</button>
            </div>
          </div>
        </div>

        <div class="card-custom group">
          <div class="border-l-4 border-l-accent pl-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <span class="badge-custom accent">üìñ Story</span>
                <h3 class="text-lg font-bold text-primary mt-2">When men do it, we are told to endure</h3>
              </div>
              <div class="text-right">
                <div class="text-xl font-bold text-accent">22</div>
                <div class="text-xs text-muted">votes</div>
              </div>
            </div>
            <p class="text-sm text-text-primary mb-3">Challenging gender inequalities and the double standards women face in society.</p>
            <div class="flex justify-between items-center text-xs">
              <span class="text-muted">Justice Seeker</span>
              <span class="text-muted">2 weeks ago</span>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="btn btn-sm btn-cta-custom w-full">‚≠ê Vote for Story</button>
            </div>
          </div>
        </div>

        <div class="card-custom group">
          <div class="border-l-4 border-l-cta pl-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <span class="badge-custom cta">üìö Training</span>
                <h3 class="text-lg font-bold text-primary mt-2">Impact Measurement Framework</h3>
              </div>
              <div class="text-right">
                <div class="text-xl font-bold text-cta">31</div>
                <div class="text-xs text-muted">votes</div>
              </div>
            </div>
            <p class="text-sm text-text-primary mb-3">Guidance on metrics that matter and frameworks to measure real impact.</p>
            <div class="flex justify-between items-center text-xs">
              <span class="text-muted">Kofi Mensah</span>
              <span class="text-muted">3 weeks ago</span>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="btn btn-sm btn-accent-custom w-full">üëç Endorse Training</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals for submitting items -->
    <!-- Submit Idea Modal -->
    <div id="submitIdea-modal" class="modal hidden">
      <div class="modal-box">
        <h3 class="font-bold text-lg text-primary mb-4">üí° Submit an Idea</h3>
        <form id="idea-form" class="space-y-4" onsubmit="submitIdea(event)">
          <div>
            <label class="block font-semibold text-primary mb-2">Idea Title <span class="text-red-500">*</span></label>
            <input id="idea-title" required placeholder="e.g., Better search filters" class="input-custom w-full" />
          </div>
          <div>
            <label class="block font-semibold text-primary mb-2">Category</label>
            <input id="idea-category" placeholder="e.g., User Experience" class="input-custom w-full" />
          </div>
          <div>
            <label class="block font-semibold text-primary mb-2">Description <span class="text-red-500">*</span></label>
            <textarea id="idea-desc" required placeholder="Tell us about your idea..." class="input-custom w-full h-20"></textarea>
          </div>
          <div class="flex gap-2 justify-end">
            <button type="button" class="btn btn-secondary-custom" onclick="hideModal('submitIdea')">Cancel</button>
            <button type="submit" class="btn btn-primary-custom">Submit Idea</button>
          </div>
        </form>
      </div>
      <label class="modal-backdrop" onclick="hideModal('submitIdea')">Close</label>
    </div>

    <!-- Submit Story Modal -->
    <div id="submitStory-modal" class="modal hidden">
      <div class="modal-box">
        <h3 class="font-bold text-lg text-primary mb-4">üìñ Share Your Story</h3>
        <form id="story-form" class="space-y-4" onsubmit="submitStory(event)">
          <div>
            <label class="block font-semibold text-primary mb-2">Story Title <span class="text-red-500">*</span></label>
            <input id="story-title" required placeholder="Short headline" class="input-custom w-full" />
          </div>
          <div>
            <label class="block font-semibold text-primary mb-2">Your Name <span class="text-red-500">*</span></label>
            <input id="story-author" required placeholder="Your name" class="input-custom w-full" />
          </div>
          <div>
            <label class="block font-semibold text-primary mb-2">Story <span class="text-red-500">*</span></label>
            <textarea id="story-content" required placeholder="What happened? Who was impacted? What changed?" class="input-custom w-full h-24"></textarea>
          </div>
          <div class="flex gap-2 justify-end">
            <button type="button" class="btn btn-secondary-custom" onclick="hideModal('submitStory')">Cancel</button>
            <button type="submit" class="btn btn-cta-custom">Share Story</button>
          </div>
        </form>
      </div>
      <label class="modal-backdrop" onclick="hideModal('submitStory')">Close</label>
    </div>

    <!-- Submit Training Modal -->
    <div id="submitTraining-modal" class="modal hidden">
      <div class="modal-box">
        <h3 class="font-bold text-lg text-primary mb-4">üìö Request Training</h3>
        <form id="training-request-form" class="space-y-4" onsubmit="submitTrainingRequest(event)">
          <div>
            <label class="block font-semibold text-primary mb-2">Topic <span class="text-red-500">*</span></label>
            <input id="req-topic" required placeholder="e.g., Digital Marketing" class="input-custom w-full" />
          </div>
          <div>
            <label class="block font-semibold text-primary mb-2">Audience</label>
            <input id="train-audience" placeholder="Who is this for?" class="input-custom w-full" />
          </div>
          <div>
            <label class="block font-semibold text-primary mb-2">Description <span class="text-red-500">*</span></label>
            <textarea id="req-desc" required placeholder="What do you want to learn and why?" class="input-custom w-full h-20"></textarea>
          </div>
          <div class="flex gap-2 justify-end">
            <button type="button" class="btn btn-secondary-custom" onclick="hideModal('submitTraining')">Cancel</button>
            <button type="submit" class="btn btn-accent-custom">Submit Request</button>
          </div>
        </form>
      </div>
      <label class="modal-backdrop" onclick="hideModal('submitTraining')">Close</label>
    </div>
  </main>

  <script src="js/main.js"></script>
  <script>
    // Initialize page once main.js is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Combine all items and render them
      renderAllItems();
    });

    // Function to render all items together
    function renderAllItems() {
      // Ensure data is loaded
      if (typeof appData === 'undefined') return;
      
      // Combine all items with type markers
      const allItems = [];
      
      // Add ideas
      if (appData.ideas && Array.isArray(appData.ideas)) {
        appData.ideas.forEach(item => {
          allItems.push({...item, type: 'idea'});
        });
      }
      
      // Add stories
      if (appData.stories && Array.isArray(appData.stories)) {
        appData.stories.forEach(item => {
          allItems.push({...item, type: 'story'});
        });
      }
      
      // Add training requests
      if (appData.trainingRequests && Array.isArray(appData.trainingRequests)) {
        appData.trainingRequests.forEach(item => {
          allItems.push({...item, type: 'training'});
        });
      }
      
      // Sort by most recent by default
      allItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      // Store for filtering
      window.allItems = allItems;
      
      // Initial render
      filterItems();
    }

    // Function to filter and display items
    function filterItems() {
      if (!window.allItems) return;
      
      const searchTerm = (document.getElementById('search-input')?.value || '').toLowerCase();
      const category = document.getElementById('category-filter')?.value || 'all';
      const sort = document.getElementById('sort-filter')?.value || 'recent';
      
      // Filter items
      let filteredItems = window.allItems.filter(item => {
        // Search filter
        const matchesSearch = !searchTerm || 
          item.title.toLowerCase().includes(searchTerm) ||
          item.description?.toLowerCase().includes(searchTerm) ||
          item.content?.toLowerCase().includes(searchTerm) ||
          item.topic?.toLowerCase().includes(searchTerm);
        
        // Category filter
        const matchesCategory = category === 'all' || item.type === category;
        
        return matchesSearch && matchesCategory;
      });
      
      // Sort items
      if (sort === 'popular') {
        filteredItems.sort((a, b) => (b.votes || b.endorsements || 0) - (a.votes || a.endorsements || 0));
      } else {
        filteredItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      }
      
      // Render items
      const itemsGrid = document.getElementById('items-grid');
      if (!itemsGrid) return;
      
      if (filteredItems.length === 0) {
        itemsGrid.innerHTML = '<p class="text-center text-muted py-8 col-span-full">No items match your search. Try different keywords or categories.</p>';
        return;
      }
      
      itemsGrid.innerHTML = filteredItems.map((item, index) => {
        // Format the item based on its type
        let title, description, author, votes, categoryLabel, icon, colorClass, voteFunction;
        
        if (item.type === 'idea') {
          title = item.title;
          description = item.description;
          author = item.author || 'Community';
          votes = item.votes || 0;
          categoryLabel = 'üí° Idea';
          icon = 'üí°';
          colorClass = 'border-l-primary';
          voteFunction = `voteOnIdeaByIndex(${index})`;
        } else if (item.type === 'story') {
          title = item.title;
          description = item.content;
          author = item.author;
          votes = item.votes || 0;
          categoryLabel = 'üìñ Story';
          icon = 'üìñ';
          colorClass = 'border-l-accent';
          voteFunction = `voteOnStoryByIndex(${index})`;
        } else if (item.type === 'training') {
          title = item.topic || item.title;
          description = item.description;
          author = item.audience ? `Audience: ${item.audience}` : 'Training Request';
          votes = item.endorsements || item.votes || 0;
          categoryLabel = 'üìö Training';
          icon = 'üìö';
          colorClass = 'border-l-cta';
          voteFunction = `endorseTrainingByIndex(${index})`;
        }
        
        return `
          <div class="card-custom group hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <div class="${colorClass} border-l-4 pl-4">
              <div class="flex justify-between items-start mb-2">
                <div>
                  <span class="badge-custom ${item.type === 'idea' ? 'primary' : item.type === 'story' ? 'accent' : 'cta'}">${icon} ${categoryLabel}</span>
                  <h3 class="text-lg font-bold text-primary mt-2 group-hover:text-accent transition-colors">${title}</h3>
                </div>
                <div class="text-right">
                  <div class="text-xl font-bold ${item.type === 'idea' ? 'text-primary' : item.type === 'story' ? 'text-accent' : 'text-cta'}">${votes}</div>
                  <div class="text-xs text-muted">votes</div>
                </div>
              </div>
              <p class="text-sm text-text-primary mb-3">${description || 'No description provided'}</p>
              <div class="flex justify-between items-center text-xs">
                <span class="text-muted">${author || 'Community'}</span>
                <span class="text-muted">${new Date(item.timestamp).toLocaleDateString()}</span>
              </div>
              <div class="mt-3 pt-3 border-t border-gray-200">
                <button class="btn btn-sm ${item.type === 'idea' ? 'btn-primary-custom' : item.type === 'story' ? 'btn-cta-custom' : 'btn-accent-custom'} w-full" onclick="${voteFunction}">
                  ${item.type === 'idea' ? 'üëç Vote for Idea' : item.type === 'story' ? '‚≠ê Vote for Story' : 'üëç Endorse Training'}
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Voting functions for combined items
    function voteOnIdeaByIndex(index) {
      if (!window.allItems || index >= window.allItems.length) return;
      
      const item = window.allItems[index];
      if (item.type !== 'idea') return;
      
      // Find the actual index in the appData.ideas array
      const ideaIndex = appData.ideas.findIndex(idea => idea.id === item.id);
      if (ideaIndex !== -1) {
        voteOnIdea(ideaIndex);
      }
    }

    function voteOnStoryByIndex(index) {
      if (!window.allItems || index >= window.allItems.length) return;
      
      const item = window.allItems[index];
      if (item.type !== 'story') return;
      
      // Find the actual index in the appData.stories array
      const storyIndex = appData.stories.findIndex(story => story.id === item.id);
      if (storyIndex !== -1) {
        voteOnStory(storyIndex);
      }
    }

    function endorseTrainingByIndex(index) {
      if (!window.allItems || index >= window.allItems.length) return;
      
      const item = window.allItems[index];
      if (item.type !== 'training') return;
      
      // Find the actual index in the appData.trainingRequests array
      const trainingIndex = appData.trainingRequests.findIndex(req => req.id === item.id);
      if (trainingIndex !== -1) {
        endorseTraining(trainingIndex);
      }
    }

    // Modal functions
    function showModal(modalId) {
      const modal = document.getElementById(modalId + '-modal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
    }

    function hideModal(modalId) {
      const modal = document.getElementById(modalId + '-modal');
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-backdrop')) {
        const modal = e.target.closest('.modal');
        if (modal) {
          modal.classList.add('hidden');
          modal.classList.remove('flex');
        }
      }
    });
  </script>

  <div id="shared-footer"></div>
  <script src="js/load-navbar.js"></script>
  <script src="js/load-footer.js"></script>
</body>
</html>